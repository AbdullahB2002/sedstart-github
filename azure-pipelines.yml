# Runs once daily at 10:00 AM India time (04:30 UTC), only Mon–Fri
schedules:
- cron: "30 4 * * 1-5"                # 04:30 UTC = 10:00 AM IST
  displayName: Daily 10 AM IST – Sedstart Prod (Weekdays only)
  branches:
    include:
      - main
  always: true                        # Runs even if no code changes

# Optional: keep manual / push trigger if you want
trigger:
  branches:
    include:
      - main

pool:
  vmImage: 'ubuntu-latest'

variables:
  - group: sedstart-secrets             # Contains GITHUB_PAT

steps:
  - task: Bash@3
    displayName: 'Dispatch Sedstart Test – Daily 10 AM IST'
    inputs:
      targetType: 'inline'
      script: |
        echo "Daily Sedstart run triggered at $(date -u +"%Y-%m-%d %H:%M UTC") → 10:00 AM IST"

        curl -s -X POST \
          "https://api.github.com/repos/AbdullahB2002/sedstart-github/actions/workflows/manual.yml/dispatches" \
          -H "Authorization: token $(GITHUB_PAT)" \
          -H "Accept: application/vnd.github.v3+json" \
          -H "Content-Type: application/json" \
          -d '{"ref":"main"}'

        echo "Dispatched successfully! Check GitHub in a minute → https://github.com/AbdullahB2002/sedstart-github/actions"
    env:
      GITHUB_PAT: $(GITHUB_PAT)